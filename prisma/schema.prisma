// ============================================
// BARBERSHOP BOOKING SYSTEM DATABASE SCHEMA
// Clean Architecture with Prisma ORM
// ============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER MANAGEMENT
// ============================================

// Users jadvali - Foydalanuvchilar (User, Barber, Admin)
model User {
  id        String   @id @default(uuid())
  email     String   @unique  // Email manzil
  phone     String   @unique  // Telefon raqam
  password  String            // Parol (hash qilingan)
  firstName String   @map("first_name")  // Ism
  lastName  String   @map("last_name")  // Familiya
  avatar    String?           // Avatar rasmi
  role      UserRole @default(USER)  // Role: USER, BARBER, ADMIN
  
  // Relations
  barber    Barber?
  bookings  Booking[]
  favorites Favorite[]
  reviews   Review[]
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

enum UserRole {
  USER
  BARBER
  ADMIN
}

// ============================================
// BARBER MANAGEMENT
// ============================================

model Barber {
  id           String     @id @default(uuid())
  userId       String     @unique @map("user_id")
  bio          String?
  specialty    String?
  experience   Int        @default(0)
  rating       Float      @default(0)
  totalReviews Int        @default(0) @map("total_reviews")
  location     String?
  latitude     Float?
  longitude    Float?
  
  // Images
  image        String?
  portfolio    String[]   @default([]) // JSON array of image URLs
  
  // Availability
  isAvailable  Boolean    @default(true) @map("is_available")
  
  // Working Hours
  workingDays  String[]   @default([]) @map("working_days") // ["monday", "tuesday", ...]
  
  // Relations
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  services     Service[]
  bookings     Booking[]
  reviews      Review[]
  favorites    Favorite[]
  schedule     Schedule[]
  
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  @@map("barbers")
}

// ============================================
// SERVICES
// ============================================

// Services jadvali - Barber xizmatlari
model Service {
  id          String   @id @default(uuid())
  barberId    String   @map("barber_id")  // Barber ID
  name        String         // Xizmat nomi
  description String?        // Tavsifi
  duration    Int      @default(30) // Davomiylik (minut)
  price       Float         // Narx (so'm)
  
  barber      Barber   @relation(fields: [barberId], references: [id], onDelete: Cascade)
  bookings    Booking[]
  
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("services")
}

// ============================================
// SCHEDULE MANAGEMENT
// ============================================

// Schedule jadvali - Ish jadvali (har bir barber uchun kunlik)
model Schedule {
  id            String   @id @default(uuid())
  barberId      String   @map("barber_id")  // Barber ID
  day           String   // Kun: "monday", "tuesday", etc.
  startTime     String   @map("start_time") // Boshlanish vaqti: "09:00"
  endTime       String   @map("end_time")   // Tugash vaqti: "18:00"
  lunchStart    String?  @map("lunch_start") // Tushlik boshlanish: "13:00"
  lunchEnd      String?  @map("lunch_end")   // Tushlik tugash: "14:00"
  isWorking     Boolean  @default(true) @map("is_working")  // Bu kunda ishlamasami
  
  barber        Barber   @relation(fields: [barberId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@unique([barberId, day])
  @@map("schedules")
}

// ============================================
// BOOKINGS
// ============================================

// Booking jadvali - Bandliklar
model Booking {
  id        String          @id @default(uuid())
  userId    String          @map("user_id")  // User ID
  barberId  String          @map("barber_id")  // Barber ID
  serviceId String          @map("service_id")  // Service ID
  
  date      DateTime        // Sana va vaqt
  startTime String          @map("start_time") // Boshlanish vaqti: "14:00"
  endTime   String          @map("end_time")   // Tugash vaqti
  
  status    BookingStatus   @default(PENDING)  // Holati: PENDING, CONFIRMED, COMPLETED...
  notes     String?         // Izohlar
  
  // Relations
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  barber    Barber          @relation(fields: [barberId], references: [id], onDelete: Cascade)
  service   Service         @relation(fields: [serviceId], references: [id])
  review    Review?
  
  createdAt DateTime        @default(now()) @map("created_at")
  updatedAt DateTime        @updatedAt @map("updated_at")

  @@map("bookings")
  @@index([userId])
  @@index([barberId])
  @@index([date])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// ============================================
// FAVORITES
// ============================================

// Favorite jadvali - Sevimli barberlar
model Favorite {
  id       String   @id @default(uuid())
  userId   String   @map("user_id")    // User ID
  barberId String   @map("barber_id")  // Barber ID
  
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  barber   Barber   @relation(fields: [barberId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([userId, barberId])
  @@map("favorites")
}

// ============================================
// REVIEWS & RATINGS
// ============================================

// Review jadvali - Sharh va reytinglar
model Review {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")      // User ID
  barberId  String   @map("barber_id")    // Barber ID
  bookingId String?  @unique @map("booking_id")  // Booking ID (ixtiyoriy)
  
  rating    Int      // Reyting: 1-5
  comment   String?  // Sharh matni
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  barber    Barber   @relation(fields: [barberId], references: [id], onDelete: Cascade)
  booking   Booking? @relation(fields: [bookingId], references: [id], onDelete: SetNull)
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("reviews")
  @@index([barberId])
  @@index([userId])
}

// ============================================
// SPECIAL OFFERS
// ============================================

// Offer jadvali - Maxsus takliflar
model Offer {
  id          String    @id @default(uuid())
  barberId    String?   @map("barber_id")  // Barber ID (ixtiyoriy)
  title       String         // Taklif nomi
  description String?        // Tavsifi
  discount    Float     @default(0)  // Chegirma foiz
  startDate   DateTime  @map("start_date")  // Boshlanish sanasi
  endDate     DateTime  @map("end_date")    // Tugash sanasi
  isActive    Boolean   @default(true) @map("is_active")  // Faolmi
  
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@map("offers")
}
